<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEDEON - Scanner d'Affiches</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: '#667eea',
                        secondary: '#10B981',
                        dark: '#111827',
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #f3f4f6; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c7c7c7; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .drag-active {
            border-color: #667eea !important;
            background-color: #eef2ff !important;
            transform: scale(1.01);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col font-sans">
    
    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-3">
                    <a href="index.html" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                        </svg>
                    </a>
                    <div class="bg-primary p-2 rounded-lg">
                        <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900 tracking-tight">GEDEON Scanner</h1>
                        <p class="text-xs text-gray-500">Extracteur d'√âv√©nements IA</p>
                    </div>
                </div>
                <div class="flex gap-4 text-sm text-gray-500 hidden sm:flex">
                    <div class="flex items-center gap-1">üì∑ Capturer</div>
                    <div class="flex items-center gap-1">ü§ñ Analyser</div>
                    <div class="flex items-center gap-1">üìÑ Exporter</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Intro (visible quand pas d'image) -->
        <div id="intro-section" class="text-center mb-10 space-y-2">
            <h2 class="text-3xl font-bold text-gray-900">Transformez vos affiches en donn√©es</h2>
            <p class="text-gray-600 max-w-2xl mx-auto">
                Utilisez l'IA Gemini pour extraire automatiquement les dates, lieux, prix et descriptions depuis n'importe quelle photo d'affiche ou flyer.
            </p>
        </div>

        <!-- Upload Section -->
        <div id="upload-section" class="max-w-xl mx-auto">
            <div id="drop-zone" class="relative border-2 border-dashed rounded-xl p-8 transition-all duration-300 ease-in-out text-center cursor-pointer bg-white border-gray-300 hover:border-primary hover:bg-gray-50">
                <input type="file" id="file-input" class="hidden" accept="image/*">
                
                <div class="flex flex-col items-center justify-center space-y-4">
                    <div id="upload-icon" class="p-4 bg-indigo-100 rounded-full text-primary">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                        </svg>
                    </div>
                    <div class="space-y-1">
                        <h3 id="upload-text" class="text-lg font-medium text-gray-900">T√©l√©charger une affiche</h3>
                        <p class="text-sm text-gray-500">Glissez-d√©posez ou cliquez pour s√©lectionner</p>
                    </div>
                    <div class="flex gap-4 text-xs text-gray-400">
                        <span>üì∑ Photo</span>
                        <span>üñºÔ∏è PNG, JPG, WEBP</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section (hidden initially) -->
        <div id="results-section" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                
                <!-- Left: Image Source -->
                <div class="lg:col-span-4 space-y-4">
                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="text-sm font-semibold text-gray-700 mb-3">Image Source</h3>
                        <div class="relative rounded-lg overflow-hidden border border-gray-200 bg-gray-50 aspect-[3/4] flex items-center justify-center">
                            <img id="preview-image" src="" alt="Affiche source" class="max-h-full max-w-full object-contain">
                            
                            <!-- Processing Overlay -->
                            <div id="processing-overlay" class="hidden absolute inset-0 bg-white/60 backdrop-blur-sm flex items-center justify-center">
                                <div class="flex flex-col items-center">
                                    <div class="animate-spin rounded-full h-10 w-10 border-4 border-primary border-t-transparent"></div>
                                    <span class="mt-3 text-sm font-medium text-primary animate-pulse">Analyse Gemini en cours...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button id="reset-btn" class="w-full flex items-center justify-center gap-2 py-2.5 px-4 bg-white border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors">
                        üîÑ Nouvelle analyse
                    </button>
                </div>

                <!-- Right: Results -->
                <div class="lg:col-span-8">
                    
                    <!-- Error Message -->
                    <div id="error-container" class="hidden bg-red-50 border border-red-200 rounded-xl p-6 flex items-start gap-4">
                        <span class="text-red-500 text-xl">‚ö†Ô∏è</span>
                        <div>
                            <h3 class="font-semibold text-red-900">Erreur d'analyse</h3>
                            <p id="error-message" class="text-red-700 text-sm mt-1 whitespace-pre-line"></p>
                        </div>
                    </div>
                    
                    <!-- Event Display -->
                    <div id="event-container" class="hidden space-y-6 animate-fade-in">
                        <!-- Event Card -->
                        <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                            <!-- Header -->
                            <div class="bg-primary px-6 py-4">
                                <span id="event-category" class="inline-block px-2 py-1 rounded bg-white/20 text-white text-xs font-semibold mb-2 backdrop-blur-sm">√âv√©nement</span>
                                <h2 id="event-title" class="text-2xl font-bold text-white leading-tight">Titre de l'√©v√©nement</h2>
                            </div>
                            
                            <div class="p-6 grid gap-6">
                                <!-- Date & Time -->
                                <div class="flex items-start gap-4">
                                    <div class="bg-indigo-50 p-2 rounded-lg text-primary">üìÖ</div>
                                    <div>
                                        <h3 class="font-semibold text-gray-900">Date et Heure</h3>
                                        <p id="event-date" class="text-gray-600">Date non sp√©cifi√©e</p>
                                        <p id="event-time" class="text-sm text-gray-500 mt-1"></p>
                                    </div>
                                </div>
                                
                                <!-- Location -->
                                <div class="flex items-start gap-4">
                                    <div class="bg-emerald-50 p-2 rounded-lg text-secondary">üìç</div>
                                    <div class="w-full">
                                        <h3 class="font-semibold text-gray-900">Lieu</h3>
                                        <p id="event-venue" class="text-gray-800 font-medium">Lieu inconnu</p>
                                        <p id="event-address" class="text-gray-600 text-sm"></p>
                                        
                                        <!-- Map -->
                                        <div id="map-container" class="hidden w-full h-48 rounded-lg overflow-hidden border border-gray-200 shadow-sm mt-3">
                                            <iframe id="event-map" width="100%" height="100%" frameborder="0" scrolling="no" loading="lazy"></iframe>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Description -->
                                <div id="description-container" class="hidden bg-gray-50 p-4 rounded-lg border border-gray-100">
                                    <h3 class="text-sm font-semibold text-gray-700 mb-2 uppercase tracking-wide">R√©sum√©</h3>
                                    <p id="event-description" class="text-gray-600 text-sm leading-relaxed"></p>
                                </div>
                                
                                <!-- Organizer & Pricing -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="border border-gray-100 rounded-lg p-4">
                                        <h3 class="text-sm font-semibold text-gray-900 mb-3">Organisateur</h3>
                                        <p id="event-organizer" class="font-medium text-gray-600">Non sp√©cifi√©</p>
                                        <div id="organizer-details" class="space-y-1 mt-2 text-sm text-gray-500"></div>
                                    </div>
                                    
                                    <div class="border border-gray-100 rounded-lg p-4">
                                        <h3 class="text-sm font-semibold text-gray-900 mb-3">Billetterie</h3>
                                        <div class="flex items-center gap-3">
                                            <div id="pricing-icon" class="p-2 rounded-full bg-green-100 text-green-700">üéüÔ∏è</div>
                                            <div>
                                                <p id="event-price" class="font-bold text-gray-900">Gratuit</p>
                                                <p id="event-currency" class="text-xs text-gray-500"></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Tags -->
                                <div id="tags-container" class="hidden flex flex-wrap gap-2 pt-2 border-t border-gray-100"></div>
                            </div>
                        </div>
                        
                        <!-- JSON Viewer -->
                        <div class="mt-8">
                            <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                                <span class="w-1.5 h-6 bg-secondary rounded-full"></span>
                                Structure JSON g√©n√©r√©e
                            </h3>
                            <div class="bg-gray-900 rounded-xl overflow-hidden shadow-lg">
                                <div class="bg-gray-800 px-4 py-3 flex justify-between items-center border-b border-gray-700">
                                    <span class="text-xs font-mono text-gray-400">event_data.json</span>
                                    <div class="flex gap-2">
                                        <button id="copy-btn" class="flex items-center gap-2 px-3 py-1.5 rounded-md text-xs font-medium bg-gray-700 text-gray-300 hover:bg-gray-600 hover:text-white transition-colors">
                                            üìã Copier
                                        </button>
                                        <button id="download-btn" class="flex items-center gap-2 px-3 py-1.5 rounded-md text-xs font-medium bg-gray-700 text-gray-300 hover:bg-gray-600 hover:text-white transition-colors">
                                            ‚¨áÔ∏è T√©l√©charger
                                        </button>
                                        <button id="add-to-gedeon-btn" class="flex items-center gap-2 px-3 py-1.5 rounded-md text-xs font-medium bg-primary text-white hover:bg-indigo-600 transition-colors">
                                            ‚ûï Ajouter √† GEDEON
                                        </button>
                                    </div>
                                </div>
                                <div class="p-4 overflow-auto max-h-96">
                                    <pre id="json-output" class="text-xs sm:text-sm font-mono text-green-400 whitespace-pre-wrap break-all"></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Skeleton Loader -->
                    <div id="skeleton-loader" class="hidden space-y-4 animate-pulse">
                        <div class="h-32 bg-gray-200 rounded-xl w-full"></div>
                        <div class="h-20 bg-gray-200 rounded-xl w-full"></div>
                        <div class="h-64 bg-gray-200 rounded-xl w-full"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 py-6 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center text-sm text-gray-500">
            <p>¬© 2025 GEDEON Scanner. Propuls√© par Google Gemini.</p>
        </div>
    </footer>

    <script>
        // Configuration - Utilise l'API serveur (proxy Gemini)
        const SERVER_URL = window.location.origin;
        
        // √âtat
        let currentEventData = null;
        
        // DOM Elements
        const introSection = document.getElementById('intro-section');
        const uploadSection = document.getElementById('upload-section');
        const resultsSection = document.getElementById('results-section');
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const previewImage = document.getElementById('preview-image');
        const processingOverlay = document.getElementById('processing-overlay');
        const errorContainer = document.getElementById('error-container');
        const errorMessage = document.getElementById('error-message');
        const eventContainer = document.getElementById('event-container');
        const skeletonLoader = document.getElementById('skeleton-loader');
        const resetBtn = document.getElementById('reset-btn');
        const copyBtn = document.getElementById('copy-btn');
        const downloadBtn = document.getElementById('download-btn');
        const addToGedeonBtn = document.getElementById('add-to-gedeon-btn');
        
        // Event Listeners
        dropZone.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileSelect);
        
        // Drag & Drop
        dropZone.addEventListener('dragenter', handleDrag);
        dropZone.addEventListener('dragleave', handleDrag);
        dropZone.addEventListener('dragover', handleDrag);
        dropZone.addEventListener('drop', handleDrop);
        
        resetBtn.addEventListener('click', reset);
        copyBtn.addEventListener('click', copyJson);
        downloadBtn.addEventListener('click', downloadJson);
        addToGedeonBtn.addEventListener('click', addToGedeon);
        
        function handleDrag(e) {
            e.preventDefault();
            e.stopPropagation();
            if (e.type === 'dragenter' || e.type === 'dragover') {
                dropZone.classList.add('drag-active');
            } else {
                dropZone.classList.remove('drag-active');
            }
        }
        
        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            dropZone.classList.remove('drag-active');
            
            const file = e.dataTransfer.files[0];
            if (file) processFile(file);
        }
        
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) processFile(file);
        }
        
        function processFile(file) {
            if (!file.type.startsWith('image/')) {
                alert('Veuillez s√©lectionner une image valide.');
                return;
            }
            
            const reader = new FileReader();
            reader.onloadend = () => {
                const dataUrl = reader.result;
                const base64 = dataUrl.split(',')[1];
                analyzeImage(base64, file.type, dataUrl);
            };
            reader.readAsDataURL(file);
        }
        
        async function analyzeImage(base64, mimeType, previewUrl) {
            // Show results section
            introSection.classList.add('hidden');
            uploadSection.classList.add('hidden');
            resultsSection.classList.remove('hidden');
            
            // Show preview
            previewImage.src = previewUrl;
            
            // Show processing state
            processingOverlay.classList.remove('hidden');
            skeletonLoader.classList.remove('hidden');
            errorContainer.classList.add('hidden');
            eventContainer.classList.add('hidden');
            
            try {
                const data = await callGeminiAPI(base64, mimeType);
                currentEventData = data;
                displayEventData(data);
            } catch (err) {
                console.error('Erreur compl√®te:', err);
                let errorMsg = "Impossible d'extraire les informations.";
                if (err.message) {
                    errorMsg += "\n\nD√©tails: " + err.message;
                }
                errorMsg += "\n\nOuvrez la console (F12) pour plus de d√©tails.";
                showError(errorMsg);
            } finally {
                processingOverlay.classList.add('hidden');
                skeletonLoader.classList.add('hidden');
            }
        }
        
        async function callGeminiAPI(base64Image, mimeType) {
            // Utilise le proxy serveur pour √©viter les probl√®mes CORS
            const url = `${SERVER_URL}/api/scanner/analyze`;
            
            console.log('ü§ñ Envoi au serveur GEDEON...');
            
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    image: base64Image,
                    mimeType: mimeType
                })
            });
            
            const result = await response.json();
            
            if (result.status === 'success') {
                console.log(`‚úÖ Analyse r√©ussie (mod√®le: ${result.model})`);
                return result.data;
            } else {
                throw new Error(result.message || 'Erreur analyse');
            }
        }
        
        function displayEventData(data) {
            eventContainer.classList.remove('hidden');
            
            // Title & Category
            document.getElementById('event-title').textContent = data.title || '√âv√©nement sans titre';
            document.getElementById('event-category').textContent = data.category || '√âv√©nement';
            
            // Date & Time
            let dateText = data.startDate || 'Date non sp√©cifi√©e';
            if (data.endDate && data.endDate !== data.startDate) {
                dateText += ` - ${data.endDate}`;
            }
            document.getElementById('event-date').textContent = dateText;
            
            let timeText = '';
            if (data.startTime) {
                timeText = `üïê ${data.startTime}`;
                if (data.endTime) timeText += ` √† ${data.endTime}`;
            }
            document.getElementById('event-time').textContent = timeText;
            
            // Location
            const venue = data.location?.venueName || 'Lieu inconnu';
            const address = [data.location?.address, data.location?.city].filter(Boolean).join(', ');
            document.getElementById('event-venue').textContent = venue;
            document.getElementById('event-address').textContent = address;
            
            // Map
            const mapQuery = [venue, address].filter(Boolean).join(', ');
            if (mapQuery && data.location?.city) {
                const mapContainer = document.getElementById('map-container');
                const mapFrame = document.getElementById('event-map');
                mapFrame.src = `https://maps.google.com/maps?q=${encodeURIComponent(mapQuery)}&t=&z=15&ie=UTF8&iwloc=&output=embed`;
                mapContainer.classList.remove('hidden');
            }
            
            // Description
            if (data.description) {
                document.getElementById('event-description').textContent = data.description;
                document.getElementById('description-container').classList.remove('hidden');
            }
            
            // Organizer
            document.getElementById('event-organizer').textContent = data.organizer?.name || 'Non sp√©cifi√©';
            const orgDetails = document.getElementById('organizer-details');
            orgDetails.innerHTML = '';
            if (data.organizer?.website) {
                orgDetails.innerHTML += `<div>üåê <a href="${data.organizer.website}" target="_blank" class="text-primary hover:underline">Site web</a></div>`;
            }
            if (data.organizer?.email) {
                orgDetails.innerHTML += `<div>üìß ${data.organizer.email}</div>`;
            }
            if (data.organizer?.phone) {
                orgDetails.innerHTML += `<div>üìû ${data.organizer.phone}</div>`;
            }
            
            // Pricing
            const pricingIcon = document.getElementById('pricing-icon');
            const priceText = document.getElementById('event-price');
            const currencyText = document.getElementById('event-currency');
            
            if (data.pricing?.isFree) {
                pricingIcon.className = 'p-2 rounded-full bg-green-100 text-green-700';
                pricingIcon.textContent = 'üéüÔ∏è';
                priceText.textContent = 'Gratuit';
                currencyText.textContent = '';
            } else {
                pricingIcon.className = 'p-2 rounded-full bg-yellow-100 text-yellow-700';
                pricingIcon.textContent = 'üí∞';
                priceText.textContent = data.pricing?.priceRange || 'Payant';
                currencyText.textContent = data.pricing?.currency ? `Devise: ${data.pricing.currency}` : '';
            }
            
            // Tags
            const tagsContainer = document.getElementById('tags-container');
            if (data.tags && data.tags.length > 0) {
                tagsContainer.innerHTML = data.tags.map(tag => 
                    `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">üè∑Ô∏è ${tag}</span>`
                ).join('');
                tagsContainer.classList.remove('hidden');
            } else {
                tagsContainer.classList.add('hidden');
            }
            
            // JSON Output
            document.getElementById('json-output').textContent = JSON.stringify(data, null, 2);
        }
        
        function showError(message) {
            errorContainer.classList.remove('hidden');
            errorMessage.textContent = message;
            eventContainer.classList.add('hidden');
        }
        
        function reset() {
            introSection.classList.remove('hidden');
            uploadSection.classList.remove('hidden');
            resultsSection.classList.add('hidden');
            currentEventData = null;
            fileInput.value = '';
        }
        
        function copyJson() {
            if (!currentEventData) return;
            navigator.clipboard.writeText(JSON.stringify(currentEventData, null, 2));
            copyBtn.textContent = '‚úÖ Copi√© !';
            setTimeout(() => { copyBtn.innerHTML = 'üìã Copier'; }, 2000);
        }
        
        function downloadJson() {
            if (!currentEventData) return;
            const blob = new Blob([JSON.stringify(currentEventData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `event-${(currentEventData.title || 'unknown').replace(/[^a-z0-9]/gi, '_').toLowerCase()}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }
        
        async function addToGedeon() {
            if (!currentEventData) return;
            
            const addBtn = document.getElementById('add-to-gedeon-btn');
            addBtn.disabled = true;
            addBtn.textContent = '‚è≥ G√©ocodage...';
            
            // Construire l'adresse pour le g√©ocodage (sans forcer France)
            const addressParts = [
                currentEventData.location?.venueName,
                currentEventData.location?.address,
                currentEventData.location?.city
            ].filter(Boolean);
            const fullAddress = addressParts.join(', ');
            
            // G√©ocoder l'adresse via l'API serveur
            let latitude = null;
            let longitude = null;
            
            try {
                console.log('üåç G√©ocodage:', fullAddress);
                const geoResponse = await fetch(`${SERVER_URL}/api/scanner/geocode`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ address: fullAddress })
                });
                const geoData = await geoResponse.json();
                
                if (geoData.status === 'success') {
                    latitude = geoData.latitude;
                    longitude = geoData.longitude;
                    console.log('‚úÖ Coordonn√©es trouv√©es:', latitude, longitude);
                } else {
                    console.warn('‚ö†Ô∏è Adresse non trouv√©e, essai avec la ville seule');
                    // Essayer avec juste la ville
                    if (currentEventData.location?.city) {
                        const cityResponse = await fetch(`${SERVER_URL}/api/scanner/geocode`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ address: currentEventData.location.city })
                        });
                        const cityData = await cityResponse.json();
                        if (cityData.status === 'success') {
                            latitude = cityData.latitude;
                            longitude = cityData.longitude;
                            console.log('‚úÖ Coordonn√©es ville:', latitude, longitude);
                        }
                    }
                }
            } catch (e) {
                console.error('‚ùå Erreur g√©ocodage:', e);
            }
            
            // Cr√©er l'√©v√©nement pour GEDEON
            const gedeonEvent = {
                uid: 'scanned-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
                title: currentEventData.title,
                category: currentEventData.category,
                begin: currentEventData.startDate,
                end: currentEventData.endDate,
                startTime: currentEventData.startTime,
                endTime: currentEventData.endTime,
                locationName: currentEventData.location?.venueName,
                city: currentEventData.location?.city,
                address: currentEventData.location?.address,
                latitude: latitude,
                longitude: longitude,
                description: currentEventData.description,
                organizer: currentEventData.organizer?.name,
                pricing: currentEventData.pricing?.isFree ? 'Gratuit' : currentEventData.pricing?.priceRange,
                tags: currentEventData.tags,
                source: 'Scanner',
                scannedAt: new Date().toISOString()
            };
            
            // Sauvegarder dans localStorage
            const existing = JSON.parse(localStorage.getItem('gedeon_scanned_events') || '[]');
            existing.push(gedeonEvent);
            localStorage.setItem('gedeon_scanned_events', JSON.stringify(existing));
            
            addBtn.disabled = false;
            addBtn.textContent = '‚ûï Ajouter √† GEDEON';
            
            if (latitude && longitude) {
                if (confirm('‚úÖ √âv√©nement g√©olocalis√© et ajout√© √† GEDEON !\n\nVoulez-vous voir la carte maintenant ?')) {
                    window.location.href = 'index.html';
                }
            } else {
                alert('‚ö†Ô∏è √âv√©nement ajout√© mais impossible de le g√©olocaliser.\nIl ne sera pas visible sur la carte.');
            }
        }
    </script>
</body>
</html>
